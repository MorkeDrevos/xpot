model User {
  id        String   @id @default(cuid())
  xHandle   String   @unique
  createdAt DateTime @default(now())

  wallets   Wallet[]
  tickets   Ticket[]
}

model Wallet {
  id        String   @id @default(cuid())
  address   String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())

  tickets   Ticket[]
  balance   XpUserBalance?
}

model XpUserBalance {
  id        String   @id @default(cuid())
  walletId  String   @unique
  wallet    Wallet   @relation(fields: [walletId], references: [id])

  balance   Int
  updatedAt DateTime @updatedAt
}

model Draw {
  id        String   @id @default(cuid())
  date      DateTime @unique
  isClosed  Boolean  @default(false)

  tickets   Ticket[]
  winnerId  String?
  winner    Ticket? @relation(fields: [winnerId], references: [id])
}

model Ticket {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  drawId    String
  draw      Draw    @relation(fields: [drawId], references: [id])

  walletId  String
  wallet    Wallet  @relation(fields: [walletId], references: [id])

  userId    String
  user      User    @relation(fields: [userId], references: [id])

  @@unique([drawId, walletId]) // one ticket per wallet per day
}
